##################
###	Базовые
##################

    #AllowOverride None

    #Если index-файл отсутсвует, то 500(F)
    Options All -Indexes

    # Выключить проход по симлинкам (ярлыкам)
    Options FollowSymLinks

    #Кодирока по умолчанию для всего сервера
    AddDefaultCharset utf-8

    # Увеличение времени жизни сессии на 1 час (php.ini)
    # php_value session.gc_maxlifetime 3600

    DirectoryIndex index.php


################## 
###	Страницы ошибок
##################

    #Вывод ошибок
    #php_flag display_errors off

    ErrorDocument 404 /index.php
    #ErrorDocument 400 /index.php
    #ErrorDocument 401 /index.php
    ErrorDocument 403 /index.php
    #ErrorDocument 405 /index.php
    #ErrorDocument 406 /index.php
    #ErrorDocument 409 /index.php
    #ErrorDocument 413 /index.php
    #ErrorDocument 414 /index.php
    ErrorDocument 500 /error.html


<IfModule mod_rewrite.c>
	
	RewriteEngine On

	# Устанавливает базовый URL для преобразований в контексте каталога
    RewriteBase /
	
    #RewriteOptions MaxRedirects=100



##################
###	SEO
##################

    # Перевод символов (латиницы) в нижний регистр
    # \x90-\xAF => А-Я
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule (.*?[A-Z\x90-\xAF]+.*) ${lc:$1} [R=301,L]

    # merge slashes
    RewriteCond %{THE_REQUEST} .*\ (.*)//(.*)\ HTTP/
    RewriteRule .* %1/%2 [R=301,L]

	#Осуществляем редирект c www на без www
	RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]
	RewriteRule ^/?(.*) http://%1/$1 [R=301,L]

	#Убрать косую черту (слэш)
	#RewriteCond %{REQUEST_FILENAME} !-d
	#RewriteRule ^(.*)/$ /$1 [R=301,L]

	#Добавить косую черту (слэш)
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_URI} !^.*(\.\w+|/)$
	RewriteRule ^(.*[^/])$ $1/ [R=301,L]

    # Осуществляем редирект c /index.php на / в корне
    RewriteCond %{THE_REQUEST} ^.*\ /index\.(?:php|htm|html)(\?.*)?\ HTTP/
    RewriteRule ^.*$ /%1 [R=301,L]

    # Осуществляем редирект c /index.php на / в остальных папках
    # RewriteRule ^(.*)/index\.(?:php|htm|html)(\?.*)?$ $1/$2 [R=301,L]


##################
###	Routing
##################

    #    RewriteCond %{REQUEST_URI} !^/(robots\.txt|favicon\.ico|error\.html|(assets/.*))$ [NC]
    #    RewriteRule ^.*$ index.php

#    # Единая точка входа
#    RewriteCond %{REQUEST_URI} ^/(app|core)/.*$ [NC,OR]
#    RewriteCond %{REQUEST_FILENAME} ^(.*)\.((p|sh)?htm(l)?|php(\d|s)?|(f)?cgi|exe|(f)?pl|asp(x)?|jsp|wml|inc|tmp|tpl)$ [NC]
#    # Исключение
#    RewriteCond %{REQUEST_URI} !^/assets/captcha/init\.php$ [NC]

    RewriteCond %{REQUEST_URI} ^\/(?!index\.php|robots\.txt|error\.html|favicon\.ico|admin\b|assets\b\/.+\.(?:js|ts|css|ico|xml|swf|flv|pdf|xls|htc|gif|jpg|png|jpeg)$).*$ [NC]
#    RewriteCond %{REQUEST_FILENAME} !-d
#    RewriteCond %{REQUEST_FILENAME} !-f
#    RewriteCond %{REQUEST_URI} !favicon\.ico
    RewriteRule ^.*$ index.php [L]

    RewriteRule ^admin/.*$ admin/index.php [L]

#    RewriteCond %{REQUEST_URI} ^\/(admin)\/(?!index\.php|favicon\.ico).*$ [NC]
#    RewriteRule ^.*$ %1/index.php [L]

##################
###	Оптимизация
##################

#### Does not every  gzip files (caching) ####
#AddEncoding gzip .gz
#RewriteCond %{HTTP:Accept-encoding} gzip
#RewriteCond %{REQUEST_FILENAME}.gz -f
#RewriteRule ^(.*)$ $1.gz [QSA,L]

##################
###	Безопасность
##################


    #Защищаем .htaccess файл
    <files ".htaccess">
        deny from all
    </files>

	### Запретить вывод на других сайтах свою статику (лишняя нагрузка и естественный DDOS) ###
	#RewriteCond %{HTTP_REFERER} !^$
	#RewriteCond %{HTTP_REFERER} !^http://(www\.)?site.ru/.*$ [NC]
	#RewriteRule \.(gif|png|jpg|jpeg|js|css|zip|rar|ico|html|php)$ - [F]

	# Способ1: Запретить доступ пользователям к файлу robots.txt, кроме поисковых ботов (их перечень представлен ниже)
	#тест RewriteCond %{REMOTE_ADDR} !=127.0.0.1
	#RewriteCond %{HTTP_USER_AGENT} !(^Accoona(.*)$|^ia_archiver(.*)$|^antabot(.*)$|^Mozilla(.*)Jeeves(.*)$|^Baiduspider(.*)$|^curl(.*)$|^EltaIndexer(.*)$|^Feedfetcher(.*)$|^GameSpy(.*)$|^Gigabot(.*)$|^(.*)Googlebot(.*)$|^gsa-crawler(.*)$|^grub-client(.*)$|^Gulper(.*)$|^(.*)Slurp(.*)$|^MihalismBot(.*)$|^Msnbot(.*)$|^OmniExplorer(.*)$|^OoyyoBot(.*)$|^Pagebull(.*)$|^Scooter(.*)$|^W3C_Validator(.*)$|^Jigsaw(.*)$|^WebAlta(.*)$|^Wget(.*)$|^(.*)Yahoo(.*)$|^(.*)Yandex(.*)$) [NC]
	#RewriteRule ^robots\.txt$ index.php [L]

	# Запретить страницы сайта отображать в iframe-ах иных ресурсов (не работает)
	#Header set X-Frame-Options DENY

	# Разрешить выполнение JavaScript, загруженного только с нашего домена.
	# Не выполнять встроенный (inline) JavaScript
	#Header set X-Content-Security-Policy "allow 'self';"

	### Рубим типичные эксплойты, как сделано в джумле ###
#	# Блокировать любой запрос, пытающийся испортить base64_encode через URL
#    RewriteCond %{QUERY_STRING} base64_encode.*\(.*\) [OR]
#	# Блокировать любой запрос, содержащий тег <script> в URL
#    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
#	# Блокировать любой запрос, пытающийся установить значение глобальных переменных PHP через URL
#    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
#	# Блокировать любой запрос, пытающийся изменить _REQUEST переменную через URL
#    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
#	# Перенаправлять заблокированные запросы на страницу 403 с запрещенными ошибками!
#	# Обычно так: RewriteRule ^(.*)$ index.php [F,L]
#    RewriteRule ^.*$ index.php

</IfModule>



################## 
###	Оптимизация
##################

#### Gzip compress ####
#AddOutputFilterByType DEFLATE text/plain
#AddOutputFilterByType DEFLATE text/html
#AddOutputFilterByType DEFLATE text/xml
#AddOutputFilterByType DEFLATE text/css
#AddOutputFilterByType DEFLATE application/xml
#AddOutputFilterByType DEFLATE application/xhtml+xml
#AddOutputFilterByType DEFLATE application/rss+xml
#AddOutputFilterByType DEFLATE application/javascript
#AddOutputFilterByType DEFLATE application/x-javascript




#<ifModule mod_expires.c>
  # ExpiresActive On
  # ExpiresDefault "access plus 1 seconds"
  # ExpiresByType text/html "access plus 1 seconds"
  # ExpiresByType image/x-icon "access plus 2592000 seconds"
  # ExpiresByType image/gif "access plus 2592000 seconds"
  # ExpiresByType image/jpeg "access plus 2592000 seconds"
  # ExpiresByType image/png "access plus 2592000 seconds"
  # ExpiresByType text/css "access plus 604800 seconds"
  # ExpiresByType text/javascript "access plus 216000 seconds"
  # ExpiresByType application/x-javascript "access plus 216000 seconds"
#</ifModule>
